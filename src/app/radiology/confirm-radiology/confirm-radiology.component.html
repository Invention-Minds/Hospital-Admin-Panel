<div class="form-row">
    <!-- Dropdown for Search By -->
     <div class="column-1">
      <div class="p-field p-col-2">
        <p-dropdown [options]="searchOptions" [(ngModel)]="selectedSearchOption" placeholder="Search By" (ngModelChange)="onSearch()" class="custom-dropdown"></p-dropdown>
      </div>
      
      <div class="p-field p-col-3">
        <input pInputText [(ngModel)]="searchValue" placeholder="Search / 123456" class="custom-input-text"  (ngModelChange)="onSearch()" />
      </div>
        
          <!-- Search and Clear Buttons -->
          <div class="p-field p-col-2 buttons-container">
            <!-- <img (click)="onSearch()" src="/icons/search.png"> -->
            <svg (click)="onClear()" class="delete" xmlns="http://www.w3.org/2000/svg" width="3.5em" height="3.5em" viewBox="0 0 24 24">
              <path fill="#fff" d="M7 21q-.825 0-1.412-.587T5 19V6q-.425 0-.712-.288T4 5t.288-.712T5 4h4q0-.425.288-.712T10 3h4q.425 0 .713.288T15 4h4q.425 0 .713.288T20 5t-.288.713T19 6v13q0 .825-.587 1.413T17 21zM17 6H7v13h10zm-7 11q.425 0 .713-.288T11 16V9q0-.425-.288-.712T10 8t-.712.288T9 9v7q0 .425.288.713T10 17m4 0q.425 0 .713-.288T15 16V9q0-.425-.288-.712T14 8t-.712.288T13 9v7q0 .425.288.713T14 17M7 6v13z" />
            </svg>
            <!-- <img (click)="onClear()" class="delete" src="/icons/delete-1.png" pTooltip="Delete"> -->
              </div>
     </div>
    
  
     <div class="p-field p-col-3 calendar" style="display: flex;gap:20px">
      <!-- <p-calendar [(ngModel)]="selectedDate" placeholder="Calendar" class="custom-calendar"></p-calendar> -->
      <button class="clear" (click)="unlock()"> <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
        <path d="M8.75 5.25C8.75 5.84674 8.51295 6.41903 8.09099 6.84099C7.66903 7.26295 7.09674 7.5 6.5 7.5C5.90326 7.5 5.33097 7.26295 4.90901 6.84099C4.48705 6.41903 4.25 5.84674 4.25 5.25C4.25 4.65326 4.48705 4.08097 4.90901 3.65901C5.33097 3.23705 5.90326 3 6.5 3C7.09674 3 7.66903 3.23705 8.09099 3.65901C8.51295 4.08097 8.75 4.65326 8.75 5.25ZM4 8C3.73478 8 3.48043 8.10536 3.29289 8.29289C3.10536 8.48043 3 8.73478 3 9V13.5C3 13.9596 3.09053 14.4148 3.26642 14.8394C3.44231 15.264 3.70012 15.6499 4.02513 15.9749C4.35013 16.2999 4.73597 16.5577 5.16061 16.7336C5.58525 16.9095 6.04037 17 6.5 17C6.95963 17 7.41475 16.9095 7.83939 16.7336C8.26403 16.5577 8.64987 16.2999 8.97487 15.9749C9.29988 15.6499 9.55769 15.264 9.73358 14.8394C9.90947 14.4148 10 13.9596 10 13.5V9C10 8.73478 9.89464 8.48043 9.70711 8.29289C9.51957 8.10536 9.26522 8 9 8H4ZM9.75 5.25C9.75 5.9 9.56 6.505 9.23 7.013C9.643 7.061 10.017 7.233 10.314 7.493C10.3747 7.497 10.4367 7.49933 10.5 7.5C10.8545 7.49997 11.204 7.41618 11.52 7.25545C11.836 7.09471 12.1095 6.86159 12.3183 6.57508C12.527 6.28857 12.6652 5.95678 12.7214 5.60676C12.7776 5.25673 12.7503 4.89838 12.6417 4.5609C12.5331 4.22343 12.3464 3.91638 12.0966 3.6648C11.8468 3.41321 11.5412 3.22421 11.2045 3.11318C10.8678 3.00216 10.5097 2.97226 10.1592 3.02593C9.8088 3.0796 9.47602 3.21531 9.188 3.422C9.542 3.943 9.75 4.572 9.75 5.25ZM9.5 16.855C9.97202 16.4328 10.3496 15.9157 10.6081 15.3376C10.8666 14.7595 11.0001 14.1333 11 13.5V9C11 8.636 10.902 8.294 10.732 8H13C13.2652 8 13.5196 8.10536 13.7071 8.29289C13.8946 8.48043 14 8.73478 14 9V13.5C14.0001 14.0452 13.8729 14.5829 13.6285 15.0702C13.384 15.5575 13.0291 15.981 12.592 16.3069C12.1549 16.6327 11.6478 16.852 11.1109 16.9472C10.5741 17.0423 10.0225 17.0108 9.5 16.855ZM13.75 5.25C13.75 5.9 13.56 6.505 13.23 7.013C13.643 7.061 14.017 7.233 14.314 7.493C14.3747 7.497 14.4367 7.49933 14.5 7.5C14.8545 7.49997 15.204 7.41618 15.52 7.25545C15.836 7.09471 16.1095 6.86159 16.3183 6.57508C16.527 6.28857 16.6652 5.95678 16.7214 5.60676C16.7776 5.25673 16.7503 4.89838 16.6417 4.5609C16.5331 4.22343 16.3464 3.91638 16.0966 3.6648C15.8468 3.41321 15.5412 3.22421 15.2045 3.11318C14.8678 3.00216 14.5097 2.97226 14.1592 3.02593C13.8088 3.0796 13.476 3.21531 13.188 3.422C13.542 3.943 13.75 4.572 13.75 5.25ZM13.5 16.855C13.972 16.4328 14.3496 15.9157 14.6081 15.3376C14.8666 14.7595 15.0001 14.1333 15 13.5V9C15 8.636 14.902 8.294 14.732 8H17C17.2652 8 17.5196 8.10536 17.7071 8.29289C17.8946 8.48043 18 8.73478 18 9V13.5C18.0001 14.0452 17.8729 14.5829 17.6285 15.0702C17.384 15.5575 17.0291 15.981 16.592 16.3069C16.1549 16.6327 15.6478 16.852 15.1109 16.9472C14.5741 17.0423 14.0225 17.0108 13.5 16.855Z" fill="#7838A6"/>
      </svg>Clear Queue</button>
      <div>
        <p-calendar 
        styleClass="custom-calendar" 
        [(ngModel)]="selectedDateRange"
        selectionMode="range"
        (ngModelChange)="onSearch()"
        
        placeholder="Calendar"
        dateFormat="dd-mm-yy">
          <ng-template pTemplate="date" let-date>
              <span>
                  {{ date.day }}
              </span>
          </ng-template>
      </p-calendar>
      <i class="fa-solid fa-angle-down calendar-icon"></i>
      <svg pTooltip="Refresh" (click)="refresh()" class="reverse" xmlns="http://www.w3.org/2000/svg" width="2.5em" height="2.5em" viewBox="-1.5 -2.5 24 24"><path fill="currentColor" d="m4.859 5.308l1.594-.488a1 1 0 0 1 .585 1.913l-3.825 1.17a1 1 0 0 1-1.249-.665L.794 3.413a1 1 0 1 1 1.913-.585l.44 1.441C5.555.56 10.332-1.035 14.573.703a9.38 9.38 0 0 1 5.38 5.831a1 1 0 1 1-1.905.608A7.381 7.381 0 0 0 4.86 5.308zm12.327 8.195l-1.775.443a1 1 0 1 1-.484-1.94l3.643-.909a1 1 0 0 1 .61-.08a1 1 0 0 1 .84.75l.968 3.88a1 1 0 0 1-1.94.484l-.33-1.322a9.381 9.381 0 0 1-16.384-1.796l-.26-.634a1 1 0 1 1 1.851-.758l.26.633a7.381 7.381 0 0 0 13.001 1.25z"/></svg>

      </div>
    </div>
      </div>


<div class="table-container" [ngClass]="{'loading': isLoading}" *ngIf="!isLoading">
    <div class="table-wrapper">
        <table class="appointment-table">
            <thead>
                <tr>
                    <th>No</th>
                    <th (click)="sortBy('firstName')" style="cursor: pointer;">
                        Patient Name
                        <span *ngIf="sortColumn === 'firstName' && sortDirection === 'asc'">&#9650;</span>
                        <span *ngIf="sortColumn === 'firstName' && sortDirection === 'desc'">&#9660;</span>
                    </th>
                    <th>PRN</th>
                    <th>Service Name</th>
                    <th (click)="sortBy('appointmentDate')" style="cursor: pointer;">
                         Date
                        <span *ngIf="sortColumn === 'appointmentDate' && sortDirection === 'asc'">&#9650;</span>
                        <span *ngIf="sortColumn === 'appointmentDate' && sortDirection === 'desc'">&#9660;</span>
                    </th>
                    <th>Time</th>
                    <!-- <th>Source</th> -->
                    <!-- <th>SMS</th>
                    <th>Email</th>
                    <th>WA</th> -->
                    <!-- <th>Status</th> -->
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
              <tr *ngIf="filteredServices.length === 0">
                <td colspan="11" class="no-records-message">
                  No records to display
                </td>
              </tr>
                <tr *ngFor="let service of getPaginatedAppointments(); let i = index">
                    <td>{{ (currentPage - 1) * itemsPerPage + i + 1 }}</td>
                    <td>{{ service.firstName }} {{ service.lastName || '' }}</td>
                    <td>{{ service.pnrNumber || '-'}}</td>
                    <td>{{ service.radioServiceName }}</td>
                    <td>{{ service.appointmentDate | date:'dd-MM-yyyy' }}</td>
                    <td>{{ service.appointmentTime }}</td>
                    <!-- <td>{{ service.requestVia }}</td> -->
                    <!-- <td>
                        <span class="sms-status" [ngClass]="{'sms-sent': service.smsSent, 'sms-not-sent': !service.smsSent}">
                          <img *ngIf="service.smsSent" src="icons/sent.svg" alt="Sent">
                          <img *ngIf="!service.smsSent" src="icons/not-sent.svg" alt="Not Sent">
                        </span>
                      </td>
                      <td>
                        <span class="sms-status"
                          [ngClass]="{'sms-sent': service.emailSent, 'sms-not-sent': !service.emailSent}">
                          <img *ngIf="service.emailSent" src="icons/sent.svg" alt="Sent">
                          <img *ngIf="!service.emailSent" src="icons/not-sent.svg" alt="Not Sent">
                        </span>
                      </td>
                      <td>
                        <span class="sms-status" [ngClass]="{'sms-sent': service.messageSent, 'sms-not-sent': !service.messageSent}">
                          <img *ngIf="service.messageSent" src="icons/sent.svg" alt="Sent">
                          <img *ngIf="!service.messageSent" src="icons/not-sent.svg" alt="Not Sent">
                        </span>
                      </td> -->
                      <!-- <td>
                        <span class="status-badge">{{ service.appointmentStatus }}</span>
                      </td> -->
                      <!-- <td>
                        <span class="status-badge" [ngClass]="{ 
                    'confirmed-status': !service.checkedIn, 
                    'checked-in-status': service.checkedIn 
                  }">
                          {{ !service.checkedIn ? 'Confirmed' : 'Checked In' }}
                        </span>
            
                      </td> -->
                    <td class="button">
                        <!-- <button class="btn-action" [disabled]="service.entry">
                          <img src="check-in.svg" alt="check" class="action-icon" (click)="completeAppointment(service)"
                            pTooltip="Entry" tooltipPosition="top">
                        </button> -->
                        <button class="start" [disabled]="service.entry" (click)="completeAppointment(service)">
                          <img class="image" src="/start.svg">Entry
                        </button>
                          <button class="finish" [disabled]="service.checkedOut" (click)="service.entry && reportDoneAppointment(service)" >
                            <img class="image" src="/finish.svg">Report Done
                          </button>
                          <button class="postPond" [disabled]="service.checkedOut" (click)="service.entry && postPond(service)" >
                            <img class="image" src="/pause.svg">Postpone
                          </button>
                          <button class="cancel" [disabled]="service.checkedOut" (click)="!service.entry && cancelAppointment(service)"  >
                            <img class="image" src="/radio-cancel.svg" alt="cancel">Cancel
                          </button>
                      </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Pagination Controls -->
    <div class="pagination">
        <button class="pagination-btn prev" (click)="prevPage()" [disabled]="currentPage === 1">←</button>
        <button class="pagination-btn next" (click)="nextPage()" [disabled]="currentPage === totalPages">→</button>
        <div class="page-info">
          Page
          <input type="number" [(ngModel)]="currentPage" min="1" [max]="totalPages" class="page-input"
            (change)="onPageChange()">
          of {{ totalPages }}
        </div>
      </div>
      <p-toast></p-toast>
      <app-delete-confirmation-dialog [showDialog]="isLockedDialogVisible"
  (close)="handleLockedDialogClose()"></app-delete-confirmation-dialog>
 
</div>
<div class="loader" *ngIf="isLoading"></div>
